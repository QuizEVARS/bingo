import React, { useState, useEffect } from 'react';

function BingoGame() {
  // Cases du bingo
  const cases = [
    "Laurent sort de chez le coiffeur/porte un polo et montre une nouvelle ressource pÃ©da Ã  un.e collÃ¨gue sur son ordi",
    "Un.e collÃ¨gue dÃ©couvre que ses vÅ“ux d'EDT ont Ã©tÃ© ignorÃ©s",
    "Au moins 3 remarques faites Ã  RÃ©my G. sur sa coupe de cheveux (dont David C.)",
    "Oumar corrige un propos de KCD sans lever la main (il l'interrompt)",
    "La direction propose aux profs docs de parler, et AngÃ¨le refuse",
    "Cris intempestifs : Â« Et les emplois du temps ? Â»",
    "Long (mais mÃ©ticuleux) PowerPoint d'Elisabeth (que personne n'Ã©coute)",
    "Le groupe Â« J'ai bossÃ© comme une malade... Â» s'assoit naturellement au milieu Ã  gauche (cÃ´tÃ© fenÃªtre) (90% de l'effectif)",
    "KCD fait la tronche lors des prises de parole syndicales",
    "On reproche Ã  la vie sco que les AED ne circulent pas assez dans les couloirs",
    "Le mot Â« laÃ¯citÃ© Â» sort avant la fin de la premiÃ¨re heure de la plÃ©niÃ¨re",
    "La photocopieuse est dÃ©jÃ  en panne",
    "Discours inutile de KCD sur le sens humain de notre mÃ©tier",
    "Sous-entendu de KCD sur la coopÃ©ration nÃ©cessaire entre les 2 listes du CA",
    "Commentaire sur la rÃ©forme du pro de l'an dernier par JÃ©rÃ´me Sarazin",
    "Les CPE annoncent un nouveau changement sur la rÃ¨gle des 5 min de retard",
    "Â« Il faut faire attention aux travers de la bienveillance Â»",
    "Sabrina encourage les collÃ¨gues Ã  cotiser Ã  l'amicale",
    "Commentaires dÃ©sagrÃ©ables lors de la prise de parole de Roxane et RÃ©my",
    "Quelqu'un arrive en retard et se fait afficher par les cheffes",
    "Aucun changement dans l'orga Â« visite aux PP Â» de l'aprÃ¨s-midi",
    "Une remarque gÃªnante est faite par quelqu'un.e sur le physique d'un.e nouveau/elle collÃ¨gue",
    "Bruits des collÃ¨gues d'EPS au fond",
    "KCD prÃ©sente les personnels d'entretien en prÃ©cisant qu'iels doivent partir trÃ¨s vite",
    "Florence C. prend frÃ©nÃ©tiquement des notes"
  ];

  // MÃ©langer les cases
  const melangerCases = () => {
    const casesCopiees = [...cases];
    // Algorithme de mÃ©lange simple
    for (let i = casesCopiees.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      const temp = casesCopiees[i];
      casesCopiees[i] = casesCopiees[j];
      casesCopiees[j] = temp;
    }
    return casesCopiees;
  };

  // CrÃ©er les cases avec leur Ã©tat
  const creerGrille = () => {
    const casesMelangees = melangerCases();
    return casesMelangees.map((texte, i) => ({
      id: i,
      texte: texte,
      coche: false
    }));
  };

  const [grille, setGrille] = useState(creerGrille());
  const [gagne, setGagne] = useState(false);

  // Cliquer sur une case
  const cocherCase = (id) => {
    const nouvelleGrille = grille.map(case_ => {
      if (case_.id === id) {
        return { ...case_, coche: !case_.coche };
      }
      return case_;
    });
    setGrille(nouvelleGrille);
  };

  // VÃ©rifier si on a gagnÃ©
  const verifierVictoire = (g) => {
    const cochees = [];
    for (let i = 0; i < g.length; i++) {
      if (g[i].coche) {
        cochees.push(i);
      }
    }

    // Lignes
    for (let ligne = 0; ligne < 5; ligne++) {
      let compteur = 0;
      for (let col = 0; col < 5; col++) {
        if (cochees.includes(ligne * 5 + col)) {
          compteur++;
        }
      }
      if (compteur === 5) return true;
    }

    // Colonnes
    for (let col = 0; col < 5; col++) {
      let compteur = 0;
      for (let ligne = 0; ligne < 5; ligne++) {
        if (cochees.includes(ligne * 5 + col)) {
          compteur++;
        }
      }
      if (compteur === 5) return true;
    }

    // Diagonales
    let diag1 = 0, diag2 = 0;
    for (let i = 0; i < 5; i++) {
      if (cochees.includes(i * 5 + i)) diag1++;
      if (cochees.includes(i * 5 + (4 - i))) diag2++;
    }
    if (diag1 === 5 || diag2 === 5) return true;

    return false;
  };

  useEffect(() => {
    setGagne(verifierVictoire(grille));
  }, [grille]);

  const recommencer = () => {
    setGrille(creerGrille());
    setGagne(false);
  };

  return (
    <div style={{
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      minHeight: '100vh',
      background: 'linear-gradient(135deg, #f0f8ff 0%, #e6e6fa 100%)',
      padding: '10px'
    }}>
      <div style={{
        backgroundColor: 'white',
        borderRadius: '15px',
        boxShadow: '0 10px 30px rgba(0,0,0,0.2)',
        padding: '15px',
        maxWidth: '400px',
        width: '100%'
      }}>
        <h1 style={{
          fontSize: '24px',
          fontWeight: 'bold',
          textAlign: 'center',
          marginBottom: '15px',
          color: '#333'
        }}>
          BINGO de PrÃ©-RentrÃ©e
        </h1>

        {gagne && (
          <div style={{
            textAlign: 'center',
            marginBottom: '15px',
            padding: '12px',
            background: 'linear-gradient(90deg, #ffd700 0%, #ffa500 100%)',
            borderRadius: '10px',
            animation: 'pulse 1s infinite'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: 'bold', color: '#333', margin: '0 0 5px 0' }}>
              ðŸŽ‰ BINGO ! ðŸŽ‰
            </h2>
            <p style={{ fontSize: '14px', color: '#555', margin: 0 }}>FÃ©licitations !</p>
          </div>
        )}

        <div style={{
          display: 'grid',
          gridTemplateColumns: 'repeat(5, 1fr)',
          gap: '3px',
          marginBottom: '15px'
        }}>
          {grille.map((case_, index) => (
            <button
              key={case_.id}
              onClick={() => cocherCase(case_.id)}
              style={{
                aspectRatio: '1',
                borderRadius: '8px',
                border: case_.coche ? '2px solid #22c55e' : '1px solid #ccc',
                fontSize: '9px',
                lineHeight: '1.2',
                fontWeight: 'normal',
                cursor: 'pointer',
                transition: 'all 0.15s ease',
                backgroundColor: case_.coche ? '#22c55e' : '#fff',
                color: case_.coche ? 'white' : '#333',
                padding: '2px'
              }}
              onMouseOver={(e) => {
                if (!case_.coche) {
                  e.target.style.backgroundColor = '#f5f5f5';
                  e.target.style.transform = 'scale(1.02)';
                }
              }}
              onMouseOut={(e) => {
                if (!case_.coche) {
                  e.target.style.backgroundColor = '#fff';
                  e.target.style.transform = 'scale(1)';
                }
              }}
            >
              <div style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                height: '100%',
                overflow: 'hidden'
              }}>
                {case_.coche ? (
                  <span style={{ fontSize: '16px' }}>âœ“</span>
                ) : (
                  <div style={{
                    textAlign: 'center',
                    wordBreak: 'break-word',
                    hyphens: 'auto'
                  }}>
                    {case_.texte}
                  </div>
                )}
              </div>
            </button>
          ))}
        </div>

        <div style={{ textAlign: 'center' }}>
          <button
            onClick={recommencer}
            style={{
              background: 'linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%)',
              color: 'white',
              fontWeight: 'bold',
              padding: '10px 20px',
              borderRadius: '25px',
              border: 'none',
              cursor: 'pointer',
              fontSize: '14px',
              boxShadow: '0 4px 15px rgba(0,0,0,0.2)',
              transition: 'all 0.2s ease'
            }}
            onMouseOver={(e) => {
              e.target.style.transform = 'scale(1.05)';
              e.target.style.background = 'linear-gradient(90deg, #2563eb 0%, #7c3aed 100%)';
            }}
            onMouseOut={(e) => {
              e.target.style.transform = 'scale(1)';
              e.target.style.background = 'linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%)';
            }}
          >
            ðŸ”„ Nouvelle partie
          </button>
        </div>
      </div>

      <style jsx>{`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.8; }
        }
      `}</style>
    </div>
  );
}

export default BingoGame;
