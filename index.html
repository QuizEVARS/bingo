import React, { useState, useEffect } from 'react';

const BingoGame = () => {
  // Contenu des cases du bingo
  const bingoContent = [
    "Laurent sort de chez le coiffeur/porte un polo et montre une nouvelle ressource pÃ©da Ã  un.e collÃ¨gue sur son ordi",
    "Un.e collÃ¨gue dÃ©couvre que ses vÅ“ux d'EDT ont Ã©tÃ© ignorÃ©s",
    "Au moins 3 remarques faites Ã  RÃ©my G. sur sa coupe de cheveux (dont David C.)",
    "Oumar corrige un propos de KCD sans lever la main (il l'interrompt)",
    "La direction propose aux profs docs de parler, et AngÃ¨le refuse",
    "Cris intempestifs : Â« Et les emplois du temps ? Â»",
    "Long (mais mÃ©ticuleux) PowerPoint d'Elisabeth (que personne n'Ã©coute)",
    "Le groupe Â« J'ai bossÃ© comme une maladeâ€¦ Â» s'assoit naturellement au milieu Ã  gauche (cÃ´tÃ© fenÃªtre) (90% de l'effectif)",
    "KCD fait la tronche lors des prises de parole syndicales",
    "On reproche Ã  la vie sco que les AED ne circulent pas assez dans les couloirs",
    "Le mot Â« laÃ¯citÃ© Â» sort avant la fin de la premiÃ¨re heure de la plÃ©niÃ¨re",
    "La photocopieuse est dÃ©jÃ  en panne",
    "Discours inutile de KCD sur le sens humain de notre mÃ©tier",
    "Sous-entendu de KCD sur la coopÃ©ration nÃ©cessaire entre les 2 listes du CA",
    "Commentaire sur la rÃ©forme du pro de l'an dernier par JÃ©rÃ´me Sarazin",
    "Les CPE annoncent un nouveau changement sur la rÃ¨gle des 5 min de retard",
    "Â« Il faut faire attention aux travers de la bienveillance Â»",
    "Sabrina encourage les collÃ¨gues Ã  cotiser Ã  l'amicale",
    "Commentaires dÃ©sagrÃ©ables lors de la prise de parole de Roxane et RÃ©my",
    "Quelqu'un arrive en retard et se fait afficher par les cheffes",
    "Aucun changement dans l'orga Â« visite aux PP Â» de l'aprÃ¨s-midi",
    "Une remarque gÃªnante est faite par quelqu'un.e sur le physique d'un.e nouveau/elle collÃ¨gue",
    "Bruits des collÃ¨gues d'EPS au fond",
    "KCD prÃ©sente les personnels d'entretien en prÃ©cisant qu'iels doivent partir trÃ¨s vite",
    "Florence C. prend frÃ©nÃ©tiquement des notes"
  ];

  // Initialiser la grille avec le contenu personnalisÃ©
  const initialGrid = bingoContent.map((content, index) => ({
    id: index,
    content: content,
    marked: false
  }));

  const [grid, setGrid] = useState(initialGrid);
  const [winner, setWinner] = useState(false);

  // Fonction pour marquer/dÃ©marquer une case
  const toggleCell = (id) => {
    setGrid(prev => 
      prev.map(cell => 
        cell.id === id ? { ...cell, marked: !cell.marked } : cell
      )
    );
  };

  // VÃ©rifier s'il y a une ligne gagnante
  const checkWinner = (gridState) => {
    const markedPositions = gridState
      .filter(cell => cell.marked)
      .map(cell => cell.id);

    // Lignes horizontales
    for (let row = 0; row < 5; row++) {
      const rowStart = row * 5;
      const rowPositions = [rowStart, rowStart + 1, rowStart + 2, rowStart + 3, rowStart + 4];
      if (rowPositions.every(pos => markedPositions.includes(pos))) {
        return true;
      }
    }

    // Lignes verticales
    for (let col = 0; col < 5; col++) {
      const colPositions = [col, col + 5, col + 10, col + 15, col + 20];
      if (colPositions.every(pos => markedPositions.includes(pos))) {
        return true;
      }
    }

    // Diagonales
    const diagonal1 = [0, 6, 12, 18, 24];
    const diagonal2 = [4, 8, 12, 16, 20];
    
    if (diagonal1.every(pos => markedPositions.includes(pos)) ||
        diagonal2.every(pos => markedPositions.includes(pos))) {
      return true;
    }

    return false;
  };

  // VÃ©rifier le gagnant Ã  chaque changement de grille
  useEffect(() => {
    setWinner(checkWinner(grid));
  }, [grid]);

  // RÃ©initialiser le jeu
  const resetGame = () => {
    setGrid(initialGrid);
    setWinner(false);
  };

  return (
    <div className="flex flex-col items-center min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-2">
      <div className="bg-white rounded-2xl shadow-2xl p-3 max-w-sm w-full">
        <h1 className="text-2xl font-bold text-center mb-4 text-gray-800">
          BINGO de PrÃ©-RentrÃ©e
        </h1>
        
        {winner && (
          <div className="text-center mb-4 p-3 bg-gradient-to-r from-yellow-300 to-orange-300 rounded-lg animate-pulse">
            <h2 className="text-xl font-bold text-gray-800 mb-1">
              ðŸŽ‰ BINGO ! ðŸŽ‰
            </h2>
            <p className="text-sm text-gray-700">FÃ©licitations !</p>
          </div>
        )}

        <div className="grid grid-cols-5 gap-1 mb-4">
          {grid.map((cell, index) => (
            <button
              key={cell.id}
              onClick={() => toggleCell(cell.id)}
              className={`
                aspect-square rounded-lg border border-gray-300 
                text-[8px] leading-tight font-normal transition-all duration-200
                hover:scale-105 active:scale-95 touch-manipulation
                ${cell.marked 
                  ? 'bg-gradient-to-br from-green-400 to-green-600 text-white border-green-500 shadow-md' 
                  : 'bg-white hover:bg-gray-50 text-gray-700'
                }
              `}
            >
              <div className="flex items-center justify-center h-full p-0.5 overflow-hidden">
                {cell.marked && <span className="text-lg">âœ“</span>}
                {!cell.marked && (
                  <div className="text-center leading-[1.1] hyphens-auto break-words">
                    {cell.content}
                  </div>
                )}
              </div>
            </button>
          ))}
        </div>

        <div className="text-center">
          <button
            onClick={resetGame}
            className="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 
                       text-white font-bold py-2 px-6 rounded-full transition-all duration-200 
                       hover:scale-105 shadow-lg text-sm touch-manipulation"
          >
            ðŸ”„ Nouvelle partie
          </button>
        </div>
      </div>
    </div>
  );
};

export default BingoGame;
